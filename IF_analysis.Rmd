---
title: "IF_analysis"
output:
  html_document:
    df_print: paged
date: "2024-07-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Adding packages

```{r}
library(readxl)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(RColorBrewer)
```


## Datasets

Reading in the data sets.

```{r}
taxa <- read_excel("~/Desktop/Iron Floc UA Project/iron_floc_impact_on_macroinvertebrate_biodiversity_taxa.xlsx")
taxa_sim <- read_excel("~/Desktop/Iron Floc UA Project/iron_floc_impact_on_macroinvertebrate_biodiversity_taxa.xlsx", 
    sheet = "simulated data DO NOT USE")
water_quality <- read_excel("~/Desktop/Iron Floc UA Project/iron_floc_impact_on_macroinvertebrate_biodiversity_water_quality.xlsx", 
    sheet = "data")
water_sim <- read_excel("~/Desktop/Iron Floc UA Project/iron_floc_impact_on_macroinvertebrate_biodiversity_water_quality.xlsx", 
    sheet = "simulate data DO NOT USE")
```


Taking a look at the formats of the data:

```{r}
str(taxa)
str(taxa_sim)
str(water_quality)

```



## Graphing

Creating graphs.

```{r}
ggplot(water_quality, aes(x=d_o, y=ferrous_iron))+
  geom_point(color="purple")+
  labs(x="Dissolved Oxygen", y= "Ferrous Iron", title="Dissolved Oxygen and Iron")+
  theme_classic()
```

## Bar Graph for iron by plot location

```{r}
ggplot(water_quality, aes(x=factor(plot_location), y=ferrous_iron, fill=factor(transect_number)))+
  geom_col(position="dodge")
```

## Question 1

Does stream restoration increase the presence of iron flocculate by creating low-flow, acidic, and high iron water conditions compared to unrestored streams?

Plot the ferrous iron, dissolved oxygen mg/l, dissolved oxygen percentage, conductivity, temperature, and turbidity by restored/unrestored. Dissolved oxygens can share a graph.
```{r}
prcnt_cvr <- water_sim %>%
  group_by(site_name) %>%
  summarize(mean_cover=mean(as.numeric(percent_cover), na.rm = TRUE))

ggplot(water_sim, aes(x=factor(condition), y=factor(ferrous_iron), fill=factor(site_name)))+
  geom_col(position="dodge")

ggplot(water_sim, aes(x=factor(analogue), y=factor(percent_cover), fill=factor(site_name)))+
  geom_col(position="dodge")

ggplot(water_sim, aes(x=site_name, y=ferrous_iron))+
         geom_bar(stat="identity")

ggplot(water_sim, aes(x=site_name, y=d_o))+
         geom_bar(stat="identity")

## d_o% goes here, rename it to remove the %

ggplot(water_sim, aes(x=site_name, y=conductivity))+
         geom_bar(stat="identity")

ggplot(water_sim, aes(x=site_name, y=temp))+
         geom_bar(stat="identity")

ggplot(water_sim, aes(x=site_name, y=turbidity))+
         geom_bar(stat="identity")

ggplot(prcnt_cvr, aes(x=site_name, y=mean_cover))+
         geom_bar(stat="identity")

ggplot(water_sim, aes(x=site_name, y=flow_rate))+
         geom_bar(stat="identity")
```

## Question 2

How does iron flocculate affect the diversity and abundance of macroinvertebrates?

Plot number of species and number of individuals by percent cover and ferrous iron. Four graphs total. A fifth graph can show the biodiversity number against percent cover/ferrous iron.

```{r}

```

## Question 3

Does the effect of iron flocculate on the abundance and diversity of macroinvertebrates depend on if a stream has been restored?

Plot the biodiversity, #of species, and #of individuals against site names, filled by condition

```{r}
##this created all_sites, if you need to summarize the total number of unique/total number of entries
all_sites <- taxa_sim %>% group_by(site_name, analogue) %>%
  ##select(site_name, taxa) %>% not necesary, try if there are errors
  summarize(count_taxa=n_distinct(taxa), total=n()) %>%
  mutate(biodiversity=count_taxa/total) ##adds the biodiversity values calculated in Q2, same result but much fewer steps as it doesn't need to create a distinct value and data point.

ggplot(all_sites, aes(x=reorder(site_name, analogue), y=biodiversity, fill=factor(analogue)))+
  ## reorder tells ggplot i'm going to reorder, the 'biodiversity' tells it what column to reorder by
  geom_bar(stat="identity")+
  labs(x="Site Names", y="Biodiversity Value (%)", fill="Analogue")

ggplot(all_sites, aes(x=reorder(site_name, analogue), y=count_taxa, fill=factor(analogue)))+
  geom_bar(stat="identity")+
  labs(x="Site Names", y="Unique Species", fill="Analogue")+
  scale_fill_brewer(palette="Set1")

ggplot(all_sites, aes(x=reorder(site_name, analogue), y=total, fill=factor(analogue)))+
  geom_bar(stat="identity")+
  labs(x="Site Names", y="Individuals Found", fill="Analogue")+
  scale_fill_brewer(palette="Set2")

ggplot(all_sites, aes(x=analogue, y=biodiversity, fill=reorder(factor(site_name), analogue)))+
  geom_col(position="dodge")+
  labs(x="Analogue Group", y="Biodiversity (%)", fill="Site Name")+
  scale_fill_brewer(palette="Accent")
```











